<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Survivor Pool Data Function</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .loading { color: #666; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .data { background: #f8f9fa; padding: 15px; border: 1px solid #ddd; margin-top: 10px; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üèà Survivor Pool Data Function Test</h1>

    <button onclick="testSurvivorFunction()">Test getSurvivorPoolData Function</button>

    <div id="status"></div>
    <div id="results"></div>

    <script>
        async function testSurvivorFunction() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');

            statusDiv.innerHTML = '<div class="loading">üîÑ Testing getSurvivorPoolData function...</div>';
            resultsDiv.innerHTML = '';

            try {
                const startTime = Date.now();

                // Test the Firebase Function
                const response = await fetch('https://us-central1-nerdfootball.cloudfunctions.net/getSurvivorPoolData');
                const data = await response.json();

                const responseTime = Date.now() - startTime;

                if (data.success) {
                    statusDiv.innerHTML = `<div class="success">‚úÖ Function test successful! Response time: ${responseTime}ms</div>`;

                    // Display the results
                    resultsDiv.innerHTML = `
                        <div class="data">
                            <h3>üìä Survivor Pool Summary</h3>
                            <p><strong>Pool ID:</strong> ${data.poolId}</p>
                            <p><strong>Total Members:</strong> ${data.data.summary.total}</p>
                            <p><strong>Alive:</strong> ${data.data.summary.alive}</p>
                            <p><strong>Eliminated:</strong> ${data.data.summary.eliminated}</p>
                            <p><strong>Not Participating:</strong> ${data.data.summary.notParticipating}</p>
                            <p><strong>Current Week:</strong> ${data.data.currentWeek}</p>
                            <p><strong>Cache Status:</strong> ${data.cached ? 'Cached' : 'Fresh'}</p>
                            ${data.cached ? `<p><strong>Cache Age:</strong> ${data.cacheAge}s</p>` : ''}

                            <h4>üìã First 5 Survivors:</h4>
                            <pre>${JSON.stringify(data.data.survivors.slice(0, 5), null, 2)}</pre>
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `<div class="error">‚ùå Function test failed: ${data.error}</div>`;
                    resultsDiv.innerHTML = `<div class="data"><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
                }

            } catch (error) {
                statusDiv.innerHTML = `<div class="error">‚ùå Network error: ${error.message}</div>`;
                resultsDiv.innerHTML = '';
                console.error('Survivor function test error:', error);
            }
        }

        // Auto-test on page load after a short delay
        setTimeout(() => {
            console.log('üèà Auto-testing survivor pool function...');
            testSurvivorFunction();
        }, 1000);
    </script>
</body>
</html>