# üèà REBUILD-NERD.MD - Complete Disaster Recovery Blueprint

**Version**: 3.0 - Enterprise Diamond Level Architecture  
**Created**: September 2025  
**Purpose**: Complete application reconstruction guide for NerdFootball fantasy sports platform

---

## üéØ EXECUTIVE SUMMARY

NerdFootball is a comprehensive fantasy NFL platform featuring confidence pools, survivor pools, and administrative tools. This document provides complete specifications to rebuild the entire application from scratch.

### Core Features
- **Confidence Pool**: Weekly NFL picks with 1-16 confidence rankings
- **Survivor Pool**: Single elimination picking (one team per week, no repeats)
- **The Grid**: Comprehensive pick visualization and results
- **Real-time Score Integration**: ESPN API integration for live game data
- **Multi-pool Architecture**: Support for multiple fantasy pools
- **Progressive Web App**: Mobile-optimized with offline capabilities

---

## üèóÔ∏è TECHNICAL ARCHITECTURE

### **Technology Stack**
```javascript
Frontend:
- HTML5 + Tailwind CSS 3.4.0
- Vanilla JavaScript (ES6+) with modular bundle architecture
- Firebase Auth, Firestore, Functions, Hosting
- Service Worker for PWA functionality

Backend:
- Firebase Functions (Node.js)
- Firebase Firestore (NoSQL database)
- Firebase Realtime Database (WebSocket alternative)
- ESPN API integration

External Services:
- ESPN Sports API
- Firebase Cloud Messaging (FCM)
- Nodemailer for email notifications
```

### **Bundle Architecture (4-Bundle System)**
The application uses a sophisticated 4-bundle architecture for optimal performance:

1. **core-bundle.js** (55KB) - Core Firebase and utility functions
2. **survivor-bundle.js** (100KB) - Survivor pool system
3. **confidence-bundle.js** (84KB) - Confidence pool system  
4. **features-bundle.js** (48KB) - Enhanced features and UI components

### **Performance Optimizations**
- Bundle dependency gating system
- Lazy loading of non-critical modules
- Firebase query result caching
- Real-time WebSocket alternative using Firebase RTDB
- Unified document architecture (500-900 reads reduced to 1-2)

---

## üìÅ PROJECT STRUCTURE

```
nerdfootball-project/
‚îú‚îÄ‚îÄ public/                     # Web root (Firebase hosting)
‚îÇ   ‚îú‚îÄ‚îÄ index.html             # Main application (626KB)
‚îÇ   ‚îú‚îÄ‚îÄ nerdfootballTheGrid.html # The Grid view
‚îÇ   ‚îú‚îÄ‚îÄ nerdfootballRules.html # Rules and documentation
‚îÇ   ‚îú‚îÄ‚îÄ nerdSurvivor.html      # Survivor redirect
‚îÇ   ‚îú‚îÄ‚îÄ manifest.json          # PWA manifest
‚îÇ   ‚îú‚îÄ‚îÄ sw.js                  # Service worker
‚îÇ   ‚îú‚îÄ‚îÄ *-bundle.js           # Core application bundles
‚îÇ   ‚îî‚îÄ‚îÄ assets/               # Images and static files
‚îú‚îÄ‚îÄ functions/                 # Firebase Functions
‚îÇ   ‚îú‚îÄ‚îÄ index.js              # Main function exports
‚îÇ   ‚îú‚îÄ‚îÄ espnNerdApi.js        # ESPN integration
‚îÇ   ‚îú‚îÄ‚îÄ realtimeGameSync.js   # Real-time score sync
‚îÇ   ‚îî‚îÄ‚îÄ pickAnalytics.js      # Analytics functions
‚îú‚îÄ‚îÄ firestore.rules           # Database security rules
‚îú‚îÄ‚îÄ firebase.json             # Firebase configuration
‚îú‚îÄ‚îÄ package.json              # Dependencies and scripts
‚îî‚îÄ‚îÄ docs/                     # Documentation
```

---

## üóÑÔ∏è DATA MODELS & FIRESTORE STRUCTURE

### **Primary Database Paths**

#### **Pool Members (Authoritative Source)**
```javascript
Path: artifacts/nerdfootball/pools/{poolId}/metadata/members
Structure: {
  userId: {
    email: "user@example.com",
    displayName: "User Name",
    role: "member" | "admin",
    participation: {
      confidence: true,
      survivor: true
    }
  }
}
```

#### **Confidence Pool Data**
```javascript
// Unified Architecture (Enterprise Performance)
Path: artifacts/nerdfootball/pools/{poolId}/confidence/{year}/weeks/{week}
Structure: {
  picks: {
    userId: {
      gameId: {
        team: "teamAbbreviation",
        confidence: 1-16
      }
    }
  },
  lastUpdated: timestamp
}

// Season Summary
Path: artifacts/nerdfootball/pools/{poolId}/confidence/{year}/summary
Structure: {
  totals: {
    userId: totalPoints
  },
  weeklyTotals: {
    week: { userId: weekPoints }
  }
}
```

#### **Survivor Pool Data**
```javascript
// Unified Document Architecture (Sub-500ms performance)
Path: artifacts/nerdfootball/pools/{poolId}/survivor/{year}/weeks/{week}
Structure: {
  picks: {
    userId: {
      team: "teamAbbreviation",
      gameId: "gameIdentifier",
      timestamp: submissionTime
    }
  },
  eliminated: ["userId1", "userId2"]
}
```

#### **Game Data (ESPN Integration)**
```javascript
Path: artifacts/nerdfootball/public/data/nerdfootball_games/{week}
Structure: {
  gameId: {
    homeTeam: "teamAbbreviation",
    awayTeam: "teamAbbreviation", 
    homeScore: number,
    awayScore: number,
    status: "scheduled" | "in_progress" | "final",
    startTime: timestamp,
    winner: "home" | "away" | null
  }
}
```

### **Legacy Data Paths (Backwards Compatibility)**
```javascript
// Legacy user profiles
artifacts/nerdfootball/public/data/nerdfootball_users/{userId}

// Legacy picks
artifacts/nerdfootball/public/data/nerdfootball_picks/{week}/submissions/{userId}

// Legacy survivor picks
artifacts/nerdfootball/public/data/nerdSurvivor_picks/{userId}
```

---

## üîê SECURITY & AUTHENTICATION

### **Firebase Auth Configuration**
```javascript
// Supported Providers
- Google OAuth 2.0
- Email/Password
- Anonymous authentication (limited access)

// Global Admins
const GLOBAL_ADMINS = [
  'WxSPmEildJdqs6T5hIpBUZrscwt2', 
  'BPQvRhpVl1ZzsBXaS7C2iFe2Xpc2'
];
```

### **Firestore Security Rules Hierarchy**
1. **isAuthenticated()** - Basic auth check
2. **isGlobalAdmin()** - Full system access
3. **isPoolAdmin(poolId)** - Pool-specific admin rights
4. **isPoolMember(poolId)** - Pool-specific member access

### **Content Security Policy**
```javascript
{
  "script-src": "'self' 'unsafe-inline' 'unsafe-eval' https://www.gstatic.com https://cdn.tailwindcss.com",
  "style-src": "'self' 'unsafe-inline' https://fonts.googleapis.com",
  "font-src": "'self' https://fonts.gstatic.com",
  "object-src": "'none'"
}
```

---

## üéÆ USER-FACING FEATURES

### **Main Application (index.html)**
```javascript
// Core Views
- Dashboard: "Your Active Picks" + "Season Leaderboard"
- Confidence Pool: Weekly pick submission with 1-16 rankings
- Survivor Pool: Single team selection with elimination tracking
- The Grid: Comprehensive pick visualization
- Rules: Game rules and instructions

// Navigation System
- Hamburger menu (top-right, slides from right)
- URL parameter routing (?view=confidence, ?view=survivor, etc.)
- Week selector with auto-cycling expanded game view
```

### **The Grid (nerdfootballTheGrid.html)**
```javascript
// Features
- All user picks displayed in grid format
- Pre-game security (picks hidden until game start)
- NFL team helmet icons with CSS backgrounds
- Real-time score updates
- Win/Loss indicators with color coding
```

### **Survivor Pool System**
```javascript
// Core Functionality
- One team pick per week (no repeats)
- Automatic elimination tracking
- Win/Lost/Not Started status display
- ESPN team name normalization
- Pool member leaderboard

// Performance Features
- Unified document architecture
- Single query loads all data
- Sub-500ms response times
```

### **Admin Features**
```javascript
// Pool Management
- Add/remove users from pools
- Modify participation flags (confidence/survivor)
- View detailed pick analytics
- Manual score overrides

// User Management
- Create new pools
- Manage pool invitations
- Set admin privileges
- Monitor user activity
```

---

## üîå EXTERNAL INTEGRATIONS

### **ESPN Sports API**
```javascript
// Primary Integration
Function: espnNerdApi.js
Endpoint: ESPN Scoreboard API
Data: Live game scores, team information, game status
Update Frequency: Real-time during games

// Team Name Normalization
"NE Patriots" <-> "New England Patriots"
"GB Packers" <-> "Green Bay Packers"
// Full mapping in espnSurvivorIntegration.js
```

### **Firebase Cloud Messaging (FCM)**
```javascript
// Notification System
- Pick deadline reminders
- Game result notifications
- Survivor elimination alerts
- Admin announcements

// VAPID Key
VAPID_KEY: 'BDZpKfQuommUrNF2w2pt_0TwpmUJU_J6ynLEOa10r_pqzcioqxKjOduP-UFxxtBh4OHzf11poHZOuyqJyHKozuY'
```

### **Email Integration (Nodemailer)**
```javascript
// SMTP Configuration
Service: Gmail
Environment Variables:
- GMAIL_EMAIL
- GMAIL_PASSWORD

// Email Types
- Welcome messages
- Pick reminders
- Weekly summaries
- Administrative notifications
```

---

## ‚öôÔ∏è FIREBASE CONFIGURATION

### **firebase.json**
```json
{
  "hosting": {
    "public": "public",
    "ignore": ["firebase.json", "**/.*", "**/node_modules/**"]
  },
  "firestore": {
    "rules": "firestore.rules"
  },
  "database": {
    "rules": "database.rules.json"
  },
  "functions": [{
    "source": "functions",
    "codebase": "default"
  }]
}
```

### **Critical Firebase Functions**
```javascript
// index.js exports
- espnScoreUpdate: ESPN integration
- sendNotification: FCM messaging
- pickAnalytics: User behavior tracking
- survivorElimination: Automatic elimination processing
- realtimeGameSync: WebSocket alternative using RTDB
```

### **Database Rules**
- Firestore: Complex role-based access control
- Realtime Database: Simple authenticated access
- Storage: Public read, admin write

---

## üì± PROGRESSIVE WEB APP FEATURES

### **manifest.json**
```json
{
  "name": "NerdFootball AI",
  "short_name": "NerdFootball",
  "start_url": "/",
  "display": "standalone",
  "theme_color": "#334155",
  "background_color": "#f1f5f9"
}
```

### **Service Worker (sw.js)**
```javascript
// Caching Strategy
- Cache-first for static assets
- Network-first for API calls
- Offline fallbacks for core features

// Features
- Offline pick viewing
- Background sync
- Push notification handling
```

### **Mobile Optimizations**
```javascript
// Touch Interfaces
- Gesture-based navigation
- Touch-friendly pick selection
- Pull-to-refresh functionality
- Haptic feedback integration

// Performance
- Lazy loading for mobile
- Optimized bundle sizes
- Touch response <100ms
```

---

## üîß DEVELOPMENT & DEPLOYMENT

### **Local Development Setup**
```bash
# Prerequisites
- Node.js 16+
- Firebase CLI
- Git

# Installation
git clone [repository]
npm install
cd functions && npm install

# Local Testing
firebase emulators:start
firebase serve --only hosting
```

### **Testing Strategy**
```javascript
// Test Types
- Unit Tests: Jest framework
- Integration Tests: Puppeteer
- Performance Tests: Automated timing
- Security Tests: Firestore rules validation

// Key Test Files
- test-*-diamond.js: Integration tests
- *.test.js: Unit tests
- app-structure*.test.js: Architecture validation
```

### **Deployment Process**
```bash
# Production Deployment
firebase deploy

# Specific Deployments
firebase deploy --only hosting
firebase deploy --only functions
firebase deploy --only firestore:rules

# Emergency Rollback
git checkout survivor-system-benchmark-v2
firebase deploy --only hosting
```

---

## üéØ CRITICAL BUSINESS RULES

### **Confidence Pool Rules**
1. Pick winners for all NFL games each week
2. Rank picks 1-16 based on confidence level
3. Higher confidence = more points if correct
4. No duplicate confidence values allowed
5. Picks locked when games start

### **Survivor Pool Rules**
1. Pick one team to win each week
2. Cannot pick the same team twice in a season
3. Eliminated if picked team loses
4. Last player(s) standing win
5. Picks locked when games start

### **Scoring System**
```javascript
// Confidence Pool
Correct Pick = Confidence Points (1-16)
Incorrect Pick = 0 points

// Survivor Pool
Correct Pick = Advance to next week
Incorrect Pick = Elimination
```

---

## üö® KNOWN ISSUES & SAFEGUARDS

### **Ghost User Prevention**
```javascript
// CRITICAL: Block ghost user
const GHOST_USER_ID = 'okl4sw2aDhW3yKpOfOwe5lH7OQj1';

// Always use pool members as authoritative source
const poolMembersPath = `artifacts/nerdfootball/pools/${poolId}/metadata/members`;
```

### **Data Integrity Checks**
1. Pool members validation before user display
2. Pick deadline enforcement
3. Duplicate confidence prevention
4. Survivor team repeat validation
5. Score sync verification

### **Performance Safeguards**
1. Query result caching
2. Bundle loading optimization
3. Firebase read minimization
4. Real-time connection management

---

## üèÜ QUALITY STANDARDS

### **Diamond Level Requirements**
- >90% test coverage mandatory
- Zero tolerance for any/unknown types
- Comprehensive error handling
- Small, testable units with single responsibility
- Firebase cost optimization in all decisions

### **Deployment Checklist**
- [ ] All tests passing (Puppeteer + Jest)
- [ ] No existing functionality broken
- [ ] Ghost users eliminated
- [ ] Pool members used everywhere
- [ ] Performance benchmarks met
- [ ] Security rules validated

---

## üìã RECONSTRUCTION PRIORITIES

### **Phase 1: Core Infrastructure**
1. Firebase project setup
2. Authentication system
3. Basic Firestore structure
4. Security rules implementation

### **Phase 2: Data Layer**
1. Pool management system
2. User management
3. Basic pick submission
4. Score data integration

### **Phase 3: User Interface**
1. Main application HTML/CSS
2. Navigation system
3. Pick submission forms
4. Results display

### **Phase 4: Advanced Features**
1. Real-time updates
2. Push notifications
3. Advanced analytics
4. Mobile optimizations

### **Phase 5: Performance & Polish**
1. Bundle optimization
2. Caching implementation
3. PWA features
4. Comprehensive testing

---

## üîó EXTERNAL DEPENDENCIES

### **NPM Packages (Root)**
```json
{
  "jest": "^29.7.0",
  "puppeteer": "^21.3.6",
  "jest-puppeteer": "^9.0.0"
}
```

### **NPM Packages (Functions)**
```json
{
  "firebase-functions": "^4.4.1",
  "firebase-admin": "^11.10.1", 
  "nodemailer": "^6.9.4",
  "axios": "^1.5.0"
}
```

### **CDN Dependencies**
```javascript
// Tailwind CSS
https://cdn.tailwindcss.com/3.4.0

// Google Fonts
https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700

// Firebase SDK (loaded dynamically)
```

---

## üéñÔ∏è BENCHMARKS & PERFORMANCE TARGETS

### **Golden Benchmark Standards**
- Branch: `survivor-system-benchmark-v2` (current production)
- Fallback: `golden-benchmark-v1` (stable baseline)
- All pool members display correctly
- Sub-500ms query response times
- ESPN integration working perfectly

### **Performance Metrics**
```javascript
Target Performance:
- API responses: <500ms
- UI interactions: <100ms
- Bundle size: <2MB total
- Firebase reads: <10 per page load
- Real-time updates: <1 second latency
```

---

## üìû SUPPORT & MAINTENANCE

### **Critical Monitoring**
1. ESPN API connectivity
2. Firebase quota usage
3. User authentication errors
4. Pick submission failures
5. Real-time sync issues

### **Regular Maintenance**
1. Weekly ESPN data validation
2. Monthly performance audits
3. Quarterly security reviews
4. Seasonal database cleanup

---

## üî¨ METHODS & PROCESSES CATALOG

This section documents the complex business logic, algorithms, and critical methods that power the NerdFootball platform. These sophisticated systems would be nearly impossible to recreate without detailed documentation.

### **1. CORE SCORING ALGORITHMS**

#### **UnifiedConfidenceManager.calculateLeaderboards()**
```javascript
// Location: public/UnifiedConfidenceManager.js:630-681
// Purpose: Calculate weekly and season confidence pool leaderboards

Algorithm Flow:
1. Extract user picks from unified document structure
2. Cross-reference with ESPN game results for scoring
3. Apply confidence point system (1-16 ranking)
4. Calculate weekly scores: Sum(confidence_points for correct_picks)
5. Sort by score descending with tie-breaking logic
6. Update season totals via updateSeasonTotals()

Key Business Logic:
- Confidence scoring: Correct pick = confidence points, wrong = 0
- Tie handling: Users with same score get same rank
- Season aggregation: Weekly scores summed across all weeks
- Filtering: Only confidence pool participants included

Performance Optimizations:
- Single document read per week (vs 500-900 individual reads)
- Pre-computed season summaries
- Intelligent caching with game-completion-based invalidation
```

#### **ESPNSurvivorIntegration.processEliminations()**
```javascript
// Location: public/espnSurvivorIntegration.js:176-243
// Purpose: Real-time survivor elimination processing with ESPN integration

Algorithm Flow:
1. Normalize team names using comprehensive mapping system
2. Match user picks to ESPN game results
3. Determine elimination status based on game outcomes
4. Handle edge cases: no picks, in-progress games, ties
5. Update user status with elimination metadata

Team Name Normalization:
- Maps variations: "NE Patriots" <-> "New England Patriots"
- Handles abbreviations: "LA Rams" -> "Los Angeles Rams"
- Case-insensitive matching for robustness

Elimination Logic:
- No pick = immediate elimination
- Wrong pick = elimination when game completes
- Correct pick = advance to next week
- In-progress games = pending status
```

#### **Bundle Dependency Gate System**
```javascript
// Location: public/bundle-dependency-gate.js
// Purpose: Ensures proper loading sequence for 4-bundle architecture

Critical Algorithm:
1. Monitor Firebase service availability
2. Queue bundle execution until dependencies ready
3. Execute bundles in dependency order
4. Handle initialization failures gracefully
5. Provide fallback mechanisms

Bundle Loading Sequence:
- core-bundle.js: Firebase utilities (55KB)
- confidence-bundle.js: Confidence pool logic (84KB)
- survivor-bundle.js: Survivor pool system (100KB)
- features-bundle.js: Enhanced UI features (48KB)

Performance Impact:
- Prevents cascade failures from undefined services
- Eliminates race conditions in initialization
- Reduces bundle size through intelligent splitting
```

### **2. PERFORMANCE-CRITICAL METHODS**

#### **UnifiedConfidenceManager.getDisplayData()**
```javascript
// Location: public/UnifiedConfidenceManager.js:89-126
// Purpose: Enterprise-level caching system reducing Firebase reads by 99%

Performance Algorithm:
1. Check multi-layer cache (5-minute TTL)
2. Single unified document read per week
3. Smart cache invalidation based on game completion
4. Participation filtering for display accuracy
5. Pre-computed statistics and metadata

Metrics:
- Reduces reads: 500-900 ‚Üí 1-2 per leaderboard load
- Target response time: <200ms
- Cache hit rate: >85% during active periods
- Cost reduction: 99% Firebase operation savings

Cache Strategy:
- Game-completion-based invalidation
- Shorter TTL during active game periods
- Permanent caching for completed weeks
- Memory-efficient cache size limits
```

#### **WeekManager.detectCurrentWeek()**
```javascript
// Location: public/weekManager.js:44-49
// Purpose: Data-driven NFL week detection replacing date calculations

Detection Algorithm:
1. Check for live/in-progress games via ESPN API
2. Analyze recent completed games in Firestore
3. Validate against known game file availability
4. Apply bounds checking (weeks 1-18)
5. Fallback to date-based estimation

Business Logic:
- Live games take precedence over date calculations
- Completed games indicate recent activity
- Graceful degradation if APIs unavailable
- User pick alignment verification
```

#### **SurvivorAutoElimination.checkEliminationsForWeek()**
```javascript
// Location: public/survivorAutoElimination.js:93-286
// Purpose: Automated survivor elimination with ESPN integration

Elimination Algorithm:
1. Fetch pool members with participation filtering
2. Load user picks and survival status
3. Cross-reference with ESPN game results
4. Apply elimination logic with edge case handling
5. Update Firestore with batch operations

Edge Case Handling:
- No pick submissions = elimination
- Late picks after games start = elimination
- Team name normalization for accurate matching
- Tie games = survival (configurable)
- API failures = graceful degradation

Performance Features:
- Batch Firestore operations
- Cache invalidation triggers
- Parallel user processing
- Comprehensive error logging
```

### **3. ESPN INTEGRATION METHODS**

#### **ESPNSurvivorIntegration.normalizeTeamName()**
```javascript
// Location: public/espnSurvivorIntegration.js:264-285
// Purpose: Critical team name mapping for accurate game matching

Normalization Mapping:
{
  'LA Rams': 'Los Angeles Rams',
  'LA Chargers': 'Los Angeles Chargers', 
  'LV Raiders': 'Las Vegas Raiders',
  'NY Giants': 'New York Giants',
  'NY Jets': 'New York Jets',
  'TB Buccaneers': 'Tampa Bay Buccaneers',
  'NE Patriots': 'New England Patriots',
  'GB Packers': 'Green Bay Packers',
  'NO Saints': 'New Orleans Saints',
  'KC Chiefs': 'Kansas City Chiefs',
  'SF 49ers': 'San Francisco 49ers'
}

Critical for:
- Accurate pick validation
- Elimination processing
- Game result matching
- User interface consistency
```

#### **ESPN Game Result Caching**
```javascript
// Location: public/espnSurvivorIntegration.js:96-174
// Purpose: Intelligent caching system for ESPN API results

Caching Strategy:
- Live games: 30-second cache TTL
- Completed games: Permanent caching
- Failed API calls: Fallback to Firestore
- Memory-efficient cache management

Game Status Processing:
- "Final"/"FINAL"/"F"/"STATUS_FINAL" = completed
- Score comparison for winner determination
- Tie game handling
- In-progress status tracking
```

### **4. SECURITY & VALIDATION METHODS**

#### **Pick Validation System**
```javascript
// Location: Multiple files - confidence/survivor validation
// Purpose: Comprehensive pick validation and conflict detection

Confidence Pool Validation:
- Unique confidence values (1-16, no duplicates)
- All games must have picks
- Picks locked when games start
- User participation verification

Survivor Pool Validation:
- One team per week maximum
- No repeat teams across season
- Pick deadline enforcement
- Elimination status verification

Security Enforcement:
- Pre-game vs post-game data access controls
- User authentication verification
- Pool membership validation
- Admin privilege checking
```

#### **The Grid Security Controls**
```javascript
// Purpose: Pre-game pick visibility restrictions

Security Algorithm:
1. Check current time vs game start times
2. Hide picks for games not yet started
3. Show picks only after kickoff
4. Maintain real-time visibility updates
5. Prevent gaming system through early reveals

Implementation:
- Server-side time validation
- Client-side UI hiding
- Database query filtering
- Real-time status updates
```

### **5. COMPLEX BUSINESS LOGIC**

#### **Real-time Game State Synchronization**
```javascript
// Location: Multiple integration files
// Purpose: Coordinate data across ESPN API, Firestore, and UI

Synchronization Flow:
1. ESPN API polling for live scores
2. Firestore update with normalized data
3. Real-time listener notifications
4. UI state updates
5. Cache invalidation triggers

Data Consistency:
- Atomic transaction operations
- Optimistic concurrency control
- Conflict resolution mechanisms
- Rollback capabilities

Performance Considerations:
- Polling rate optimization
- Bandwidth usage minimization
- UI update batching
- Memory leak prevention
```

#### **Automatic Pool Progression**
```javascript
// Location: public/unifiedSurvivorManager.js:287-354
// Purpose: Advance surviving users to next week

Progression Algorithm:
1. Process current week eliminations
2. Identify surviving users
3. Carry forward previous picks history
4. Initialize next week document structure
5. Update participation statistics

Business Rules:
- Only users with picks advance
- Previous picks prevent reuse
- Statistics carry forward
- Document versioning for integrity
```

#### **Unified Document Architecture**
```javascript
// Purpose: Single document per week containing all user data

Document Structure:
{
  weekNumber: integer,
  picks: { userId: pickData },
  gameResults: { gameId: resultData },
  leaderboards: { weekly: [], season: [] },
  stats: { totalUsers, averageScore, pickDistribution },
  cache: { lastUpdated, gamesComplete, invalidateAfter }
}

Benefits:
- 99% reduction in Firebase reads
- Atomic transaction support
- Real-time synchronization
- Efficient query patterns
- Cost optimization
```

### **6. INTEGRATION POINTS & DEPENDENCIES**

#### **Bundle Loading Dependencies**
```javascript
Dependency Chain:
1. Firebase SDK initialization
2. Core bundle (authentication, database)
3. Feature bundles (confidence, survivor, features)
4. UI initialization and event binding

Critical Timing:
- Firebase globals must be available before bundle execution
- DOM must be ready before UI binding
- User authentication before data access
- Pool selection before feature loading
```

#### **ESPN API Integration Points**
```javascript
Primary Endpoints:
- getCurrentWeekScores(): Live game data
- getWeekGames(week): Historical game results
- Team roster and schedule data

Fallback Mechanisms:
- Firestore backup data
- Cached results
- Manual override capabilities
- Error state handling
```

#### **Firebase Operation Patterns**
```javascript
Read Optimization:
- Unified documents reduce query count
- Batch operations for efficiency
- Real-time listeners for live updates
- Cache-first strategies

Write Optimization:
- Transaction-based updates
- Batch write operations
- Optimistic concurrency
- Conflict resolution

Security Integration:
- Role-based access control
- Pool membership verification
- Admin privilege enforcement
- Data validation rules
```

---

**Last Updated**: September 2025  
**Document Version**: 3.0  
**Project Status**: Production Ready - Diamond Level

---

*This document contains all necessary information to completely rebuild the NerdFootball platform. Follow the reconstruction priorities and maintain the quality standards outlined above.*