// DIAMOND-LEVEL OPTIMIZED FEATURES BUNDLE - SYNTAX FIXED
class PickAnalyticsClient{constructor(f,p=null){this.functions=f;this.poolId=p||this.getCurrentPool();this.cache=new Map();this.cacheTimeout=300000;}getCurrentPool(){if(typeof getCurrentPool==='function')return getCurrentPool();return'nerduniverse-2025';}getCacheKey(w,t='analytics'){return`${this.poolId}_${w}_${t}`;}setCacheData(w,d,t='analytics'){this.cache.set(this.getCacheKey(w,t),{data:d,timestamp:Date.now()});}getCacheData(w,t='analytics'){const c=this.cache.get(this.getCacheKey(w,t));if(!c)return null;if(Date.now()-c.timestamp>this.cacheTimeout){this.cache.delete(this.getCacheKey(w,t));return null;}return c.data;}async getWeeklyAnalytics(w,u=true){try{if(u){const c=this.getCacheData(w);if(c)return{success:true,data:c,fromCache:true};}const g=window.httpsCallable(this.functions,'getAnalytics');const r=await g({poolId:this.poolId,week:w.toString()});if(r.data&&r.data.success){const a=r.data.analytics;if(u)this.setCacheData(w,a);return{success:true,data:a,fromCache:false,generated:r.data.generated||false};}else{throw new Error('Failed to fetch analytics data');}}catch(e){return{success:false,error:e.message,fromCache:false};}}async recalculateAnalytics(w){try{const c=window.httpsCallable(this.functions,'calculateAnalytics');const r=await c({poolId:this.poolId,week:w.toString(),force:true});if(r.data&&r.data.success){this.cache.delete(this.getCacheKey(w));return{success:true,data:r.data.analytics,message:r.data.message};}else{throw new Error('Failed to recalculate analytics');}}catch(e){return{success:false,error:e.message};}}async getGamePickPercentages(w,g){const r=await this.getWeeklyAnalytics(w);if(!r.success)return{success:false,error:r.error};const ga=r.data.gameAnalytics[g];if(!ga)return{success:false,error:'Game not found in analytics data'};return{success:true,data:{gameId:g,teamPercentages:ga.teamPercentages,totalPicks:ga.totalPicks,popularityScore:ga.popularityScore,averageConfidence:ga.confidenceStats.average}};}async getUserSimilarities(w){const r=await this.getWeeklyAnalytics(w);return r.success?{success:true,data:r.data.userSimilarity}:{success:false,error:r.error};}async getPickClusters(w){const r=await this.getWeeklyAnalytics(w);return r.success?{success:true,data:r.data.pickClusters}:{success:false,error:r.error};}async getConfidenceAnalytics(w){const r=await this.getWeeklyAnalytics(w);return r.success?{success:true,data:r.data.confidenceAnalytics}:{success:false,error:r.error};}async getContrarianPicks(w,t=30){const r=await this.getWeeklyAnalytics(w);if(!r.success)return{success:false,error:r.error};const g=[];Object.entries(r.data.gameAnalytics).forEach(([gameId,gameData])=>{if(gameData.contrarian&&gameData.contrarian.picks.length>0){g.push({gameId,contrarianPicks:gameData.contrarian.picks,contrarianScore:gameData.contrarian.score,popularityScore:gameData.popularityScore});}});g.sort((a,b)=>b.contrarianScore-a.contrarianScore);return{success:true,data:g};}async getConfidenceExtremes(w){const r=await this.getWeeklyAnalytics(w);return r.success?{success:true,data:{highestConfidence:r.data.confidenceAnalytics.extremes.highestConfidence,lowestConfidence:r.data.confidenceAnalytics.extremes.lowestConfidence}}:{success:false,error:r.error};}async getAnalyticsSummary(w){const r=await this.getWeeklyAnalytics(w);if(!r.success)return{success:false,error:r.error};const d=r.data;const gc=Object.keys(d.gameAnalytics).length;const tp=d.totalPicksets;let cg=0,crg=0,hcg=0,lcg=0;Object.values(d.gameAnalytics).forEach(gd=>{if(gd.popularityScore>=70)cg++;if(gd.contrarian.score>=30)crg++;if(gd.confidenceStats.average>=12)hcg++;if(gd.confidenceStats.average<=6)lcg++;});const cs={highAgreement:d.pickClusters.highAgreement?.length||0,moderateAgreement:d.pickClusters.moderateAgreement?.length||0,lowAgreement:d.pickClusters.lowAgreement?.length||0,contrarians:d.pickClusters.contrarians?.length||0};return{success:true,data:{week:w,totalGames:gc,totalPicksets:tp,lastUpdated:d.metadata?.lastUpdated,summary:{consensusGames:cg,contrarianGames:crg,highConfidenceGames:hcg,lowConfidenceGames:lcg},clusters:cs,dataQuality:d.metadata?.dataQuality||'unknown'}};}clearCache(){this.cache.clear();}getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())};}}
class PickAnalyticsUI{constructor(a){this.analytics=a;}formatTeamPercentages(){return'';}formatConfidenceStats(){return'';}formatPickClusters(){return'';}async displaySummary(){}}
async function addEnhancedGameData(g,game,gs){try{if(!game||!game.away||!game.home)return;const eg=await window.espnApi.getWeekGames(currentWeek);const espn=eg.find(e=>(e.a===game.away||e.awayTeam===game.away)&&(e.h===game.home||e.homeTeam===game.home));if(espn){const c=document.getElementById(gs==='IN_PROGRESS'?`live-data-${g}`:`game-data-${g}`);if(c){let ed=[];if(espn.weather){ed.push(`<div class="flex items-center gap-1"><span>🌡️</span><span>${espn.weather.temperature}°F ${espn.weather.condition||espn.weather.description||''}</span></div>`);}if(espn.venue){ed.push(`<div class="flex items-center gap-1"><span>${espn.venue.indoor?'🏟️':'🌤️'}</span><span>${espn.venue.name}</span></div>`);}if(gs==='IN_PROGRESS'&&espn.probability){const hp=espn.probability.homeWinPercentage||espn.probability.homeWin;const ap=espn.probability.awayWinPercentage||espn.probability.awayWin;if(hp||ap){ed.push(`<div class="flex items-center gap-1 text-emerald-600 font-medium"><span>📊</span><span>Win Prob: ${game.home} ${hp}% | ${game.away} ${ap}%</span></div>`);}}if(espn.broadcasts&&espn.broadcasts.length>0){const n=espn.broadcasts[0].network||espn.broadcasts[0].names?.[0];if(n){ed.push(`<div class="flex items-center gap-1"><span>📺</span><span>${n}</span></div>`);}}if(ed.length>0){c.innerHTML=ed.join('');}}}}catch(e){}}
async function addEnhancedGameDataToPicks(g,game,gs){try{if(!game||!game.away||!game.home)return;const wn=(typeof currentWeek!=='undefined')?currentWeek:(typeof window.currentWeek!=='undefined')?window.currentWeek:1;const eg=await window.espnApi.getWeekGames(wn);const espn=eg.find(e=>(e.a===game.away||e.awayTeam===game.away)&&(e.h===game.home||e.homeTeam===game.home));if(espn){const c=document.getElementById(`picks-espn-data-${g}`);if(c){let ed=[];if(espn.weather&&espn.weather.temperature){const ti=espn.weather.temperature>70?'☀️':espn.weather.temperature>50?'🌤️':espn.weather.temperature>32?'☁️':'❄️';ed.push(`<div class="flex items-center gap-1 text-xs text-slate-600"><span class="text-sm">${ti}</span><span><strong>${espn.weather.temperature}°F</strong> ${espn.weather.condition||espn.weather.description||''}</span></div>`);}if(espn.venue&&espn.venue.name){const vi=espn.venue.indoor?'🏟️':'🌤️';const l=espn.venue.city&&espn.venue.state?` • ${espn.venue.city}, ${espn.venue.state}`:'';ed.push(`<div class="flex items-center gap-1 text-xs text-slate-600"><span class="text-sm">${vi}</span><span><strong>${espn.venue.name}</strong>${l}</span></div>`);}if(espn.broadcasts&&espn.broadcasts.length>0){const ns=espn.broadcasts.map(b=>b.network).filter(Boolean).join(', ');if(ns){const ipt=ns.includes('NBC')||ns.includes('ESPN')||ns.includes('FOX')||ns.includes('CBS');const tvi=ipt?'📺⭐':'📺';ed.push(`<div class="flex items-center gap-1 text-xs text-slate-600"><span class="text-sm">${tvi}</span><span><strong>${ns}</strong>${ipt?' (Primetime)':''}</span></div>`);}}if(ed.length>0){c.innerHTML=`<div class="space-y-1">${ed.join('')}</div>`;c.classList.remove('hidden');}else{c.classList.add('hidden');}}}}catch(e){}}
function addEnhancedDataContainers(){document.querySelectorAll('[id^="game-"], [id^="live-data-"]').forEach(c=>{if(!c.querySelector('.live-game-data')){const ec=document.createElement('div');ec.className='live-game-data mt-1 space-y-0.5 text-xs text-slate-600';c.appendChild(ec);}});}
document.addEventListener('DOMContentLoaded',()=>{addEnhancedDataContainers();window.addEventListener('espnScoresUpdated',(e)=>{if(typeof renderActivePicksSummary==='function'){renderActivePicksSummary();}});});
class LiveGameRefresh{constructor(){this.refreshInterval=null;this.isRefreshing=false;this.refreshIntervalMs=30*1000;this.lastRefreshTime=null;this.activeListeners=new Set();}async hasLiveGames(wn=null){try{const cw=wn||window.currentWeek||this.getCurrentWeek();let g=[];if(window.gameStateCache){const ff=async()=>{const r=await fetch(`nfl_2025_week_${cw}.json`);if(r.ok){const wd=await r.json();return wd.games||[];}return[];};g=await window.gameStateCache.cacheSchedule(cw,ff);}else{const r=await fetch(`nfl_2025_week_${cw}.json`);if(r.ok){const wd=await r.json();g=wd.games||[];}}const now=new Date();const lg=g.filter(game=>{const gt=new Date(game.dt||game.kickoff);const gea=new Date(gt.getTime()+(4*60*60*1000));return now>=gt&&now<=gea&&(!game.winner||game.winner==='TBD');});return lg.length>0;}catch(e){return false;}}getCurrentWeek(){if(typeof window!=='undefined'&&window.currentWeek)return window.currentWeek;const now=new Date();const ss=new Date('2025-09-04');const wms=7*24*60*60*1000;const wd=Math.floor((now-ss)/wms)+1;return Math.min(Math.max(wd,1),18);}async startLiveRefresh(wn=null){if(this.refreshInterval)return;const cw=wn||window.currentWeek||this.getCurrentWeek();const hl=await this.hasLiveGames(cw);if(!hl)return;this.refreshInterval=setInterval(async()=>{await this.performLiveRefresh(cw);},this.refreshIntervalMs);await this.performLiveRefresh(cw);}stopLiveRefresh(){if(this.refreshInterval){clearInterval(this.refreshInterval);this.refreshInterval=null;}}async performLiveRefresh(wn){if(this.isRefreshing)return;this.isRefreshing=true;this.lastRefreshTime=new Date();try{if(window.espnScoreSync){const sr=await window.espnScoreSync.syncWeekScores(wn);if(sr.success&&sr.updatedCount>0){this.notifyUIRefresh(wn,sr.updatedCount);return;}}if(window.gameStateCache){window.gameStateCache.invalidateAfterDataUpdate('live_game_refresh',wn);}this.notifyUIRefresh(wn,0);const shl=await this.hasLiveGames(wn);if(!shl){this.stopLiveRefresh();}}catch(e){}finally{this.isRefreshing=false;}}notifyUIRefresh(wn,uc=0){const e=new CustomEvent('liveGameRefresh',{detail:{weekNumber:wn,updatedCount:uc,timestamp:new Date().toISOString()}});window.dispatchEvent(e);this.showRefreshNotification(wn,uc);this.triggerUIUpdates(wn);}showRefreshNotification(wn,uc){const cv=this.getCurrentView();if(!['picks','leaderboard','grid'].includes(cv)){return;}if(uc>0){this.glowUpdatedGames();}}getCurrentView(){if(document.getElementById('picks-container')&&!document.getElementById('picks-container').classList.contains('hidden')){return'picks';}if(document.getElementById('leaderboard-container')&&!document.getElementById('leaderboard-container').classList.contains('hidden')){return'leaderboard';}if(document.getElementById('grid-container')&&!document.getElementById('grid-container').classList.contains('hidden')){return'grid';}return'unknown';}glowUpdatedGames(){const ge=new Set();const gc=document.querySelectorAll('.pick-game-row, .game-row, div[id^="game-row-"]');gc.forEach(c=>{if(!ge.has(c)){c.classList.add('game-updated-glow');ge.add(c);setTimeout(()=>{c.classList.remove('game-updated-glow');},3000);}});if(ge.size===0){const gb=document.querySelectorAll('.winner-btn[data-game-id]');const up=new Map();gb.forEach(b=>{const gid=b.dataset.gameId;if(!up.has(gid)){const p=b.closest('div[class*="border"], .pick-game-row, .game-container');if(p){up.set(gid,p);}}});up.forEach(p=>{p.classList.add('game-updated-glow');ge.add(p);setTimeout(()=>{p.classList.remove('game-updated-glow');},3000);});}if(typeof window.showGameUpdateIndicator==='function'){window.showGameUpdateIndicator();}}triggerUIUpdates(wn){if(typeof currentWeek!=='undefined'&&currentWeek==wn){const lb=document.getElementById('leaderboard-body');if(lb&&lb.closest('.hidden')===null){if(typeof calculateLeaderboardOptimized==='function'){calculateLeaderboardOptimized();}}const ps=document.getElementById('picks-summary-container');if(ps&&ps.closest('.hidden')===null){if(typeof loadPicksSummary==='function'){loadPicksSummary();}}const gc=document.getElementById('grid-container');if(gc&&gc.closest('.hidden')===null){if(typeof loadGridData==='function'){loadGridData();}}}}addEventListener(c){const l=(e)=>c(e.detail);this.activeListeners.add(l);window.addEventListener('liveGameRefresh',l);return l;}removeEventListener(l){if(this.activeListeners.has(l)){window.removeEventListener('liveGameRefresh',l);this.activeListeners.delete(l);}}initialize(){this.startLiveRefresh();if(typeof allUI!=='undefined'&&allUI.weekSelector){allUI.weekSelector.addEventListener('change',()=>{this.stopLiveRefresh();setTimeout(()=>this.startLiveRefresh(),1000);});}document.addEventListener('visibilitychange',()=>{if(document.hidden){this.stopLiveRefresh();}else{this.startLiveRefresh();}});}getStatus(){return{isActive:!!this.refreshInterval,isRefreshing:this.isRefreshing,lastRefresh:this.lastRefreshTime,intervalMs:this.refreshIntervalMs,currentWeek:window.currentWeek||this.getCurrentWeek()};}}
class MobileTouchOptimizer{constructor(){this.touchStartTime=0;this.touchDebounceDelay=50;this.activeGestures=new Set();this.touchStartPos={x:0,y:0};this.isInitialized=false;this.touchMetrics={responseTimes:[],averageResponse:0,targetReached:false};}initialize(){if(this.isInitialized)return;this.setupPassiveEventListeners();this.applyHardwareAcceleration();this.setupTouchDebouncing();this.setupGestureSupport();this.applyMobileCSSOptimizations();this.setupHapticFeedback();this.isInitialized=true;}setupPassiveEventListeners(){const po={passive:true,capture:true};document.addEventListener('touchstart',this.handleTouchStart.bind(this),po);document.addEventListener('touchmove',this.handleTouchMove.bind(this),po);document.addEventListener('touchend',this.handleTouchEnd.bind(this),po);document.addEventListener('wheel',(e)=>{},po);}applyHardwareAcceleration(){const ac=`.winner-btn,.confidence-select,#prev-week-btn,#next-week-btn,#survivor-prev-week,#survivor-next-week,.hamburger-menu{transform:translateZ(0);will-change:transform,opacity;backface-visibility:hidden;-webkit-transform:translateZ(0);-webkit-backface-visibility:hidden}.winner-btn:active,.confidence-select:active{transform:translateZ(0) scale(0.98);transition:transform 0.05s ease-out}.winner-btn,.confidence-select,button{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}@media (max-width:768px){.winner-btn{min-height:44px;padding:12px 16px;touch-action:manipulation}.confidence-select{min-height:44px;font-size:16px;touch-action:manipulation}#prev-week-btn,#next-week-btn{min-height:44px;min-width:44px;padding:12px 16px;touch-action:manipulation}}.touch-active{transform:translateZ(0) scale(0.98);opacity:0.8;transition:transform 0.05s ease-out,opacity 0.05s ease-out}`;const s1=document.createElement('style');s1.id='mobile-touch-acceleration';s1.textContent=ac;document.head.appendChild(s1);}setupTouchDebouncing(){document.querySelectorAll('.winner-btn, .confidence-select, button').forEach(e=>{let ltt=0;e.addEventListener('touchstart',(ev)=>{const now=Date.now();if(now-ltt<this.touchDebounceDelay){ev.preventDefault();return false;}ltt=now;},{passive:false});});}handleTouchStart(e){this.touchStartTime=performance.now();this.touchStartPos={x:e.touches[0].clientX,y:e.touches[0].clientY};const t=e.target.closest('.winner-btn, .confidence-select, button');if(t){t.classList.add('touch-active');this.triggerHapticFeedback('light');}}handleTouchMove(e){if(!this.touchStartPos)return;const mx=Math.abs(e.touches[0].clientX-this.touchStartPos.x);const my=Math.abs(e.touches[0].clientY-this.touchStartPos.y);if(mx>10||my>10){document.querySelectorAll('.touch-active').forEach(el=>el.classList.remove('touch-active'));}}handleTouchEnd(e){const tet=performance.now();const rt=tet-this.touchStartTime;this.recordResponseTime(rt);document.querySelectorAll('.touch-active').forEach(el=>{setTimeout(()=>el.classList.remove('touch-active'),50);});this.touchStartTime=0;this.touchStartPos={x:0,y:0};}setupGestureSupport(){}handleSwipeGesture(d){}applyMobileCSSOptimizations(){const mc=`@media (max-width:768px){.winner-btn:hover,.winner-btn:focus{transform:translateZ(0) scale(1.02);transition:transform 0.1s cubic-bezier(0.23,1,0.32,1)}.confidence-select{background-attachment:scroll;-webkit-appearance:none;appearance:none}#prev-week-btn:active,#next-week-btn:active{transform:translateZ(0) scale(0.95);background-color:#475569}.picks-container,.leaderboard-container{-webkit-overflow-scrolling:touch;scroll-behavior:smooth}#survivor-prev-week:active,#survivor-next-week:active{transform:translateZ(0) scale(0.95)}}`;const s2=document.createElement('style');s2.id='mobile-optimizations';s2.textContent=mc;document.head.appendChild(s2);}setupHapticFeedback(){this.hasHapticSupport='vibrate'in navigator||('hapticFeedback'in navigator);}triggerHapticFeedback(i='light'){if(!this.hasHapticSupport)return;try{if('vibrate'in navigator){const p={light:[10],medium:[15],heavy:[25]};navigator.vibrate(p[i]||p.light);}}catch(e){}}showGestureIndicator(t){}recordResponseTime(t){this.touchMetrics.responseTimes.push(t);if(this.touchMetrics.responseTimes.length>50){this.touchMetrics.responseTimes.shift();}const s=this.touchMetrics.responseTimes.reduce((a,b)=>a+b,0);this.touchMetrics.averageResponse=s/this.touchMetrics.responseTimes.length;this.touchMetrics.targetReached=this.touchMetrics.averageResponse<100;}getMetrics(){return{averageResponseTime:this.touchMetrics.averageResponse,measurements:this.touchMetrics.responseTimes.length,targetAchieved:this.touchMetrics.targetReached,target:100};}}
if(typeof window!=='undefined'){window.PickAnalyticsClient=PickAnalyticsClient;window.PickAnalyticsUI=PickAnalyticsUI;window.addEnhancedGameData=addEnhancedGameData;window.addEnhancedGameDataToPicks=addEnhancedGameDataToPicks;window.addEnhancedDataContainers=addEnhancedDataContainers;window.LiveGameRefresh=LiveGameRefresh;window.MobileTouchOptimizer=MobileTouchOptimizer;}
if(typeof window!=='undefined'&&document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>{window.liveGameRefresh=new LiveGameRefresh();window.mobileTouchOptimizer=new MobileTouchOptimizer();setTimeout(()=>{if(window.liveGameRefresh){window.liveGameRefresh.initialize();}if(window.mobileTouchOptimizer){window.mobileTouchOptimizer.initialize();}},2000);});}else if(typeof window!=='undefined'){window.liveGameRefresh=new LiveGameRefresh();window.mobileTouchOptimizer=new MobileTouchOptimizer();setTimeout(()=>{if(window.liveGameRefresh){window.liveGameRefresh.initialize();}if(window.mobileTouchOptimizer){window.mobileTouchOptimizer.initialize();}},1000);}
if(typeof window!=='undefined'){window.testGameGlow=function(){if(window.liveGameRefresh){window.liveGameRefresh.glowUpdatedGames();}else{window.liveGameRefresh=new LiveGameRefresh();window.liveGameRefresh.glowUpdatedGames();}return'Test triggered - check console for debug output';};}